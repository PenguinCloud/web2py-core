---
- name: Install nginx
  apt:
    name: nginx-core
    state: present
- name: pull down web2py
  ansible.builtin.get_url:
    url: https://mdipierro.pythonanywhere.com/examples/static/web2py_src.zip
    dest: /tmp/web2py_src.zip
- name: unzip web2py 
  ansible.builtin.unarchive:
    src: /tmp/web2py_src.zip
    dest: /var/www/html
    remote_src: yes
    owner: www-data
    group: www-data
- name: general nginx ssl self signed
  ansible.builtin.command: openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt -subj "/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com"
- name: general nginx dhparam
  ansible.builtin.command: openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048
- name: Copy nginx template to /etc/nginx/sites-available/default
  ansible.builtin.template:
    src: /etc/ansible/templates/nginx-default.j2
    dest: /etc/nginx/sites-available/default
    owner: www-data
    group: www-data
    mode: 0644
- name: Enable nginx default
  ansible.builtin.file: 
    src: /etc/nginx/sites-available/default 
    dest: /etc/nginx/sites-enabled/default
    state: link
    owner: www-data
    group: www-data
    mode: 0644

